<!-- These two lines just for local development! -->
<script type="text/javascript" src="//use.typekit.net/ik/zsNivKk1hDQ-YXcv3_aytoqMsKu9U4GR83TC3ztvDr9feC32fFHN4UJLFRbh52jhWD9u52qX52baZQsKweBcjcs85QSojDyRjsTNZYm8ShNuie6kw2IuOcFzdPUaiaS0ZYm8ShNuie6kw2IuOcFzdPUCdhFydeyzSabC-cN0jWsGjAtlSh8CjhNR-kuEpRgcO1FUiABkZWF3jAF8OcFzdP37OcTzdcBX-eB0OWFTdeFzjhClp1G3ZKoDSWmyScmDSeBRZPoRdhXK2YgkdayTdAIldcNhjPJ4Z1mXiW4yOWgXH6qJ73IbMg6gJMJ7fbKCMsMMeMC6MKG4f5J7IMMjMkMfH6qJtkGbMg6FJMJ7fbKzMsMMeMb6MKG4fOMgIMMj2KMfH6qJnbIbMg6eJMJ7fbK0MsMMegM6MKG4fJCgIMMjgkMfH6qJRMIbMg6sJMJ7fbKTMsMMeM66MKG4fHGgIMMjIKMfH6qJKbIbMg64JMJ7fbKHMsMMegw6MKG4fJZmIMIjMkMfH6qJ6u9bMs6FJMJ7fbKImsMgeMb6MKG4fJmmIMIj2KMfH6qJxubbMs6BJMJ7fbKMmsMgeMv6MKG4fJBmIMIjgkMfH6qJ689bMs6sJMJ7fbKYmsMgeM66MKG4fJymIMIjIKMfqMYLvjKlgb.js"></script>
<link rel="stylesheet" href="https://use.typekit.net/c/c45028/1w;futura-pt,2,SH7:W:i3,SH9:W:i4,SH4:W:i5,SH6:W:i7,SHD:W:i8,SHB:W:n3,Y5K:W:n4,SH3:W:n5,SH5:W:n7,SHC:W:n8;proxima-nova,2,gbh:W:i1,gbk:W:i3,gbm:W:i4,gbr:W:i6,gbt:W:i7,gbw:W:i8,gby:W:i9,gbg:W:n1,gbj:W:n3,gbl:W:n4,gbq:W:n6,gbs:W:n7,gbv:W:n8,gbx:W:n9/l?3bb2a6e53c9684ffdc9a9bf11f5b2a623a5a2311fd229ac483f9f610bff987943ede62b3088d6d999c6cd3c785dba3c64f570770d47ed25024d9695a3d9a7fecd3560132d23805381e5c9909231fecc189f7f3d6d8603a889c06278291a1f361527ba020a26990ae606d3be5272f27852289e2e723427f45839ed00b410aa56664f24f6539477102576c1b77eb8c8c3fe7859adb635ef0812e7ecf91e051f9feb70b1b9ca7cd917edbecc693498281" media="all"><script type="text/javascript">try{Typekit.load();}catch(e){}</script>



<style>
    body {
        font-family: sans-serif;
    }

    .ds-dashboard-widgets {
        width: 100%;
        padding: 0;
        float: left;
        text-align: center;
    }

    .ds-dashboard-widgets .stat, .ds-dashboard-widgets .stat-title {
        display: block;
        text-transform: uppercase;
    }

    .ds-dashboard-widgets .stat {
        color: #198089;
        font-family: "futura-pt";
        font-weight: bold;
        font-size: 50px;
        letter-spacing: -4px;
        line-height: 0.8em;
        padding-bottom: 15px;
    }

    .ds-dashboard-widgets .stat small {
        font-size: 45%;
        letter-spacing: -3px;
        font-weight: normal;
        line-height: 0.8em;
    }

    .ds-dashboard-widgets .stat-title {
        color: #737373;
        font-size: 20px;
        letter-spacing: 2px;
        line-height: 1.3em;
    }

    @media screen and (min-width: 650px) {
        .ds-dashboard-widgets {
            padding: 10px 0 20px 0;
        }

        .ds-dashboard-widgets.full-width {
            width: 100%;
        }

        .ds-dashboard-widgets.half-width {
            width: 50%;
        }

        .ds-dashboard-widgets.third-width {
            width: 50%;
        }
    }

    @media screen and (min-width: 800px) {
        .ds-dashboard-widgets.full-width {
            width: 100%;
        }

        .ds-dashboard-widgets.half-width {
            width: 50%;
        }

        .ds-dashboard-widgets.third-width {
            width: 33%;
        }

        .ds-dashboard-widgets .stat {
            font-size: 70px;
            letter-spacing: -5px;
        }

        .ds-dashboard-widgets .stat-title {
            font-size: 18px;
        }
    }
</style>

<div class="ds-dashboard-widgets full-width">
    <p>
        <span class="stat" id="set-one" data-countdown="dec 5 2015 19:00:00"></span>
        <span class="stat-title">Expedition duration</span>
    </p>
</div>
<div  data-lat="-90" data-lon="0">
    <div class="ds-dashboard-widgets third-width">
        <p>
            <span class="stat temperature">&#160;</span>
            <span class="stat-title">Antarctic<br/>temperature</span>
        </p>
    </div>
    <div class="ds-dashboard-widgets third-width">
        <p>
            <span class="stat time" data-timezone="-3">&#160;</span>
            <span class="stat-title">Antarctic<br/>time</span>
        </p>
    </div>
    <div class="ds-dashboard-widgets third-width">
        <p>
            <span class="stat wind_speed">&#160;</span>
            <span class="stat-title">Antarctic<br/>windspeed</span>
        </p>
    </div>
</div>
<div class="ds-dashboard-widgets effort set-one-effort half-width">
    <p>
        <span class="stat calories" data-calories="10000">&#160;</span>
        <span class="stat-title">Calories<br/>burnt</span>
    </p>
</div>
<div class="ds-dashboard-widgets effort set-one-effort half-width">
    <p>
        <span class="stat steps" data-steps ="41714">&#160;</span> <!-- 730 miles * 2k steps / 35 days = 41714 -->
        <span class="stat-title">Steps<br/>taken</span>
    </p>
</div>
<div class="ds-dashboard-widgets effort set-one-effort half-width">
    <p>
        <span class="stat miles" data-miles ="21">&#160;</span> <!-- 730 miles / 35 days = 20.86 -->
        <span class="stat-title">Miles<br/>covered</span>
    </p>
</div>

<script>
    (function() {
        'use strict';

        var
            SECOND = 1000,
            MINUTE = 60 * SECOND,
            HOUR = 60 * MINUTE,
            DAY = 24 * HOUR;

        var uniformNumber = function(n) {
            if (n < 10) n = '0' + n;

            return n;
        };

        var ajax = function(url, callback) {
            var xhr;

            if (window.XMLHttpRequest) {
                // code for IE7+, Firefox, Chrome, Opera, Safari
                xhr = new XMLHttpRequest();
            } else {
                // code for IE6, IE5
                xhr = new ActiveXObject("Microsoft.XMLHTTP");
            }

            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    callback(JSON.parse(xhr.responseText));
                }
            };

            xhr.open('GET', url, true);
            xhr.send();
        };

        var jsonp = function(url, callback) {
            var callbackName = 'callback' + Math.round(Math.random() * 99999);

            window[callbackName] = function(data) {
                callback(data);
                delete window[callbackName];
                scriptEl.parentNode.removeChild(scriptEl);
            };

            var scriptEl = document.createElement('script');
            scriptEl.setAttribute('src', url + '&callback=' + callbackName);
            document.body.appendChild(scriptEl);
        };

        var timezone = function() {

                var timezoneElements = document.querySelectorAll("[data-timezone]");

                if (timezoneElements.length) {
                    for (var i = 0; i < timezoneElements.length; i++) {
                        var timezone = parseInt(timezoneElements[i].getAttribute('data-timezone'));
                        var currentTime = new Date();
                        var offsetTime = currentTime.getTime();
                        offsetTime += currentTime.getTimezoneOffset() * MINUTE; // Get UTC
                        offsetTime += timezone * HOUR; // Add timezone offset
                        offsetTime = new Date(offsetTime); // Convert back to date

                        timezoneElements[i].innerHTML = uniformNumber(offsetTime.getHours()) + ':' + uniformNumber(offsetTime.getMinutes());
                    }
                }
            },

            countup = function() {

                var countDownElements = document.querySelectorAll("[data-countdown]");

                if (countDownElements.length) {
                    var uniformNumber = function(n) {
                        if (n < 10) n = '0' + n;

                        return n;
                    };

                    var update = function(UniqueID) {
                        var currentDate = new Date();
                        var duration = currentDate - startDate;

                        if (duration < 0) duration = 0;

                        if (document.getElementById(UniqueID)) {
                            document.getElementById(UniqueID).setAttribute('data-elapsed', duration);

                            var days = parseInt(duration / DAY);
                            duration = duration % DAY;

                            var hours = parseInt(duration / HOUR);
                            duration = duration % HOUR;

                            var minutes = parseInt(duration / MINUTE);
                            duration = duration % MINUTE;

                            var seconds = parseInt(duration / SECOND);

                            document.getElementById(UniqueID).innerHTML = uniformNumber(days) + ' <small>days</small> ' + uniformNumber(hours) + ' <small>hrs</small> ' + uniformNumber(minutes) + ' <small>min</small> ' + uniformNumber(seconds) + ' <small>sec</small>';
                        }
                    };



                    for (var i = 0; i < countDownElements.length; i++) {
                        var startDate = new Date(countDownElements[i].getAttribute('data-countdown'));
                        var UniqueID = "timer_" + new Date().getTime().toString();

                        if (!countDownElements[i].id) {
                            countDownElements[i].id = UniqueID;
                        }

                        var elementID = countDownElements[i].id;

                        if (isNaN(startDate.getTime())) {
                            return false; // Only proceed if we have a current date
                        }

                        setInterval(update, SECOND, elementID);
                        update(elementID);

                        var effortID = elementID + '-effort';

                        if (document.querySelector("." + effortID)) {
                            setInterval(effort, SECOND * 5, elementID, effortID);
                        }
                        effort(elementID, effortID);
                    }
                }

            },

            weather = function() {

                var weatherElements = document.querySelectorAll("[data-lat]");

                var updateWeather = function(data) {
                    try {
                        var temperature = Math.round(data.main.temp);
                        var wind_speed = data.wind.speed;

                        weatherElements[0].querySelector(".temperature").innerHTML = temperature + ' <small>&deg;C</small>';
                        weatherElements[0].querySelector(".wind_speed").innerHTML = wind_speed + '<small>m/s</small>';
                    } catch (e) {
                        console.log('error', e);
                    }
                };

                if (weatherElements.length) {

                    for (var i=0; i < weatherElements.length; i++) {
                        var lat = weatherElements[i].getAttribute('data-lat');
                        var lon = weatherElements[i].getAttribute('data-lon');
                        var UniqueID = "weather_" + new Date().getTime().toString();
                        weatherElements[i].id = UniqueID;

                        jsonp(
                            '//api.openweathermap.org/data/2.5/weather?lat=' + lat + '&lon=' + lon + '&units=metric&APPID=8c5974c961ce95405a6d008676ca4555',
                            updateWeather
                        );
                    }
                }
            },

            effort = function(timeID, effortID) {
                var calorieContainer = document.querySelector("." + effortID + " > p .calories");
                var calorieRate = calorieContainer.getAttribute('data-calories') / 1440;
                var calorieID = "cal_" + new Date().getTime().toString();
                calorieContainer.id = calorieID;

                var stepsContainer = document.querySelector("." + effortID + " > p .steps");
                var milesContainer = document.querySelector("." + effortID + " > p .miles");

                var stepsRate = stepsContainer.getAttribute('data-steps') / 1440;
                var stepID = "step_" + new Date().getTime().toString();
                stepsContainer.id = stepID;

                var milesRate = milesContainer.getAttribute('data-miles') / 1440;
                var milesID = "miles_" + new Date().getTime().toString();
                milesContainer.id = milesID;

                var timeElapsed = document.getElementById(timeID).getAttribute('data-elapsed');

                var caloriesBurnt = numberWithCommas(Math.round(calorieRate * (timeElapsed / MINUTE)));

                var stepsTaken = numberWithCommas(Math.round(stepsRate * (timeElapsed / MINUTE)));
                var milesTaken = numberWithCommas(Math.round(milesRate * (timeElapsed / MINUTE)));

                //set to display
                document.getElementById(calorieID).innerHTML = caloriesBurnt;
                document.getElementById(stepID).innerHTML = stepsTaken;
                document.getElementById(milesID).innerHTML = milesTaken;
            };

        function numberWithCommas(x) {
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        timezone();
        countup();
        weather();

    }());
</script>